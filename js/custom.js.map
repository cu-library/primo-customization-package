{"version":3,"sources":["node_modules/browser-pack/_prelude.js","primo-explore/custom/01OCUL_CRL-CRL_DEFAULT/js/main.js","primo-explore/custom/01OCUL_CRL-CRL_DEFAULT/node_modules/primo-explore-hathitrust-availability/index.js","primo-explore/custom/01OCUL_CRL-CRL_DEFAULT/node_modules/primo-explore-hathitrust-availability/js/hathi-trust-availability.module.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","app","angular","component","template","bindings","parentCtrl","controller","this","encodingVal","chatContainer","document","createElement","id","classList","add","body","appendChild","x","type","async","src","location","protocol","y","getElementsByTagName","parentNode","insertBefore","constant","config","$sceDelegateProvider","hathiTrustBaseUrl","urlWhitelist","resourceUrlWhitelist","push","factory","$http","$q","lookup","ids","hathiTrustLookupUrl","join","jsonp","cache","jsonpCallbackParam","then","resp","data","resolve","svc","findRecord","bibData","items","recordId","Object","keys","records","recordURL","catch","console","error","findFullViewRecord","fullTextUrl","result","j","item","usRightsString","toLowerCase","fromRecord","hathiTrust","self","$onInit","msg","hideOnline","isOnline","hideIfJournal","isJournal","updateHathiTrustAvailability","isOclcNum","value","match","prmSearchResultAvailabilityLine","pnx","addata","format","indexOf","delivery","GetIt1","some","g","links","l","isLinktoOnline","deliveryCategory","hathiTrustIds","oclcid","filter","map","replace","ignoreCopyright","res","fullTextLink","link","entityId"],"mappings":"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","file":"custom.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","import 'primo-explore-hathitrust-availability';\n(function () {\n    'use strict';\n    var app = angular.module('viewCustom', ['angularLoad', 'hathiTrustAvailability']);\n    // Include HathiTrust full text links.\n    app.component('prmSearchResultAvailabilityLineAfter', {\n        template: '<hathi-trust-availability msg=\"Full Text Available Online at HathiTrust\" ignore-copyright=\"true\" entity-id=\"http://cufed.carleton.ca/adfs/services/trust\"></hathi-trust-availability>'\n    })\n    // Change the default RIS export character encoding to UTF-8\n    app.component('prmExportRisAfter', {\n        bindings: { parentCtrl: '<' },\n        controller: function() { this.parentCtrl.encodingVal = 'UTF-8'; },\n        template: ''\n    });\n})();\n(function() {\n    // Add the LibraryH3lp container to the page.\n    var chatContainer = document.createElement('div');\n    chatContainer.id = 'libraryh3lp-container';\n    chatContainer.classList.add('needs-js');\n    document.body.appendChild(chatContainer);\n    // Add the LibraryH3lp script, which adds the chat button.\n    var x = document.createElement(\"script\");\n    x.type = \"text/javascript\";\n    x.async = true;\n    x.src = (document.location.protocol === \"https:\" ? \"https://\" : \"http://\") + \"ca.libraryh3lp.com/js/libraryh3lp.js?1213\";\n    var y = document.getElementsByTagName(\"script\")[0];\n    y.parentNode.insertBefore(x, y);\n})();\n","require('./js/hathi-trust-availability.module.js');\nmodule.exports = 'hathiTrustAvailability';\n","angular\n  .module(\"hathiTrustAvailability\", [])\n  .constant(\n    \"hathiTrustBaseUrl\",\n    \"https://catalog.hathitrust.org/api/volumes/brief/json/\"\n  )\n  .config([\n    \"$sceDelegateProvider\",\n    \"hathiTrustBaseUrl\",\n    function($sceDelegateProvider, hathiTrustBaseUrl) {\n      var urlWhitelist = $sceDelegateProvider.resourceUrlWhitelist();\n      urlWhitelist.push(hathiTrustBaseUrl + \"**\");\n      $sceDelegateProvider.resourceUrlWhitelist(urlWhitelist);\n    }\n  ])\n  .factory(\"hathiTrust\", [\n    \"$http\",\n    \"$q\",\n    \"hathiTrustBaseUrl\",\n    function($http, $q, hathiTrustBaseUrl) {\n      var svc = {};\n\n      var lookup = function(ids) {\n        if (ids.length) {\n          var hathiTrustLookupUrl = hathiTrustBaseUrl + ids.join(\"|\");\n          return $http\n            .jsonp(hathiTrustLookupUrl, {\n              cache: true,\n              jsonpCallbackParam: \"callback\"\n            })\n            .then(function(resp) {\n              return resp.data;\n            });\n        } else {\n          return $q.resolve(null);\n        }\n      };\n\n      // find a HT record URL for a given list of identifiers (regardless of copyright status)\n      svc.findRecord = function(ids) {\n        return lookup(ids)\n          .then(function(bibData) {\n            if (bibData && bibData[ids[0]].items.length > 0) {\n              var recordId = Object.keys(bibData[ids[0]].records)[0];\n              return $q.resolve(bibData[ids[0]].records[recordId].recordURL);\n            } else {\n              return $q.resolve(null);\n            }\n          })\n          .catch(function(e) {\n            console.error(e);\n          });\n      };\n\n      // find a public-domain HT record URL for a given list of identifiers\n      svc.findFullViewRecord = function(ids) {\n        var handleResponse = function(bibData) {\n          var fullTextUrl = null;\n          for (var i = 0; !fullTextUrl && i < ids.length; i++) {\n            var result = bibData[ids[i]];\n            for (var j = 0; j < result.items.length; j++) {\n              var item = result.items[j];\n              if (item.usRightsString.toLowerCase() === \"full view\") {\n                fullTextUrl = result.records[item.fromRecord].recordURL;\n                break;\n              }\n            }\n          }\n          return $q.resolve(fullTextUrl);\n        };\n        return lookup(ids)\n          .then(handleResponse)\n          .catch(function(e) {\n            console.error(e);\n          });\n      };\n\n      return svc;\n    }\n  ])\n  .controller(\"hathiTrustAvailabilityController\", [\n    \"hathiTrust\",\n    function(hathiTrust) {\n      var self = this;\n\n      self.$onInit = function() {\n        if (!self.msg) self.msg = \"Full Text Available at HathiTrust\";\n\n        // prevent appearance/request iff 'hide-online' \n        if (self.hideOnline && isOnline()) { return; }\n\n        // prevent appearance/request iff 'hide-if-journal'\n        if (self.hideIfJournal && isJournal()) { return; }\n\n        // look for full text at HathiTrust \n        updateHathiTrustAvailability();\n      };\n\n      var isJournal = function() {\n        var format =  self.prmSearchResultAvailabilityLine.result.pnx.addata.format[0];\n        return !(format.toLowerCase().indexOf(\"journal\") == -1); // format.includes(\"Journal\")\n      };\n\n      var isOnline = function() {\n        var delivery = self.prmSearchResultAvailabilityLine.result.delivery || [];\n        if (!delivery.GetIt1) return delivery.deliveryCategory.indexOf('Alma-E') !== -1;\n        return self.prmSearchResultAvailabilityLine.result.delivery.GetIt1.some(\n          function(g) {\n            return g.links.some(function(l) {\n              return l.isLinktoOnline;\n            });\n          }\n        );\n      };\n\n      var formatLink = function(link) {\n        return self.entityId ? link + \"?signon=swle:\" + self.entityId : link;\n      };\n\n      var isOclcNum = function(value) {\n        return value.match(/^\\(ocolc\\).+/i);\n      }\n\n      var updateHathiTrustAvailability = function() {\n        var hathiTrustIds = (\n          self.prmSearchResultAvailabilityLine.result.pnx.addata.oclcid || []\n        )\n        .filter(isOclcNum)\n        .map(function(id) {\n          return \"oclc:\" + id.toLowerCase().replace(\"(ocolc)\", \"\");\n        });\n        hathiTrust[self.ignoreCopyright ? \"findRecord\" : \"findFullViewRecord\"](\n          hathiTrustIds\n        ).then(function(res) {\n          if (res) self.fullTextLink = formatLink(res);\n        });\n      };\n    }\n  ])\n  .component(\"hathiTrustAvailability\", {\n    require: {\n      prmSearchResultAvailabilityLine: \"^prmSearchResultAvailabilityLine\"\n    },\n    bindings: {\n      entityId: \"@\",\n      ignoreCopyright: \"<\",\n      hideIfJournal: \"<\",\n      hideOnline: \"<\",\n      msg: \"@?\"\n    },\n    controller: \"hathiTrustAvailabilityController\",\n    template:\n      '<span ng-if=\"$ctrl.fullTextLink\" class=\"umnHathiTrustLink\">\\\n                <md-icon alt=\"HathiTrust Logo\">\\\n                  <svg version=\"1.1\" id=\"Layer_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" width=\"100%\" height=\"100%\" viewBox=\"0 0 16 16\" enable-background=\"new 0 0 16 16\" xml:space=\"preserve\">  <image id=\"image0\" width=\"16\" height=\"16\" x=\"0\" y=\"0\"\\\n                  xlink:href=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAACBjSFJN\\\n                  AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAACNFBMVEXuegXvegTsewTveArw\\\n                  eQjuegftegfweQXsegXweQbtegnsegvxeQbvegbuegbvegbveQbtegfuegbvegXveQbvegbsfAzt\\\n                  plfnsmfpq1/wplPuegXvqFrrq1znr2Ptok/sewvueQfuegbtegbrgRfxyJPlsXDmlTznnk/rn03q\\\n                  pVnomkjnlkDnsGnvwobsfhPveQXteQrutHDqpF3qnUnpjS/prmDweQXsewjvrWHsjy7pnkvqqGDv\\\n                  t3PregvqhB3uuXjusmzpp13qlz3pfxTskC3uegjsjyvogBfpmkHpqF/us2rttXLrgRjrgBjttXDo\\\n                  gx/vtGznjzPtfhHqjCfuewfrjCnwfxLpjC7wtnDogBvssmjpfhLtegjtnEjrtnTmjC/utGrsew7s\\\n                  o0zpghnohB/roUrrfRHtsmnlkTbrvH3tnEXtegXvegTveQfqhyHvuXjrrGTpewrsrmXqfRHogRjt\\\n                  q2Dqewvqql/wu3vqhyDueQnwegXuegfweQPtegntnUvnt3fvxI7tfhTrfA/vzJvmtXLunEbtegrw\\\n                  egTregzskjbsxI/ouoPsqFzniyrz2K3vyZnokDLpewvtnkv30J/w17XsvYXjgBbohR7nplnso1L0\\\n                  1Kf40Z/um0LvegXngBnsy5juyJXvsGftrGTnhB/opVHoew7qhB7rzJnnmErkkz3splbqlT3smT3t\\\n                  tXPqqV7pjzHvunjrfQ7vewPsfA7uoU3uqlruoEzsfQ/vegf///9WgM4fAAAAFHRSTlOLi4uLi4uL\\\n                  i4uLi4uLi4tRUVFRUYI6/KEAAAABYktHRLvUtndMAAAAB3RJTUUH4AkNDgYNB5/9vwAAAQpJREFU\\\n                  GNNjYGBkYmZhZWNn5ODk4ubh5WMQERUTl5CUEpWWkZWTV1BUYlBWUVVT19BUUtbS1tHV0zdgMDQy\\\n                  NjE1MzRXsrC0sraxtWOwd3B0cnZxlXZz9/D08vbxZfDzDwgMCg4JdQsLj4iMio5hiI2LT0hMSk5J\\\n                  TUvPyMzKzmHIzcsvKCwqLiktK6+orKquYZCuratvaGxqbmlta+8QNRBl6JQ26Oru6e3rnzBx0uQ8\\\n                  aVGGvJopU6dNn1E8c9bsOXPniYoySM+PXbBw0eIlS5fl1C+PFRFlEBUVXbFy1eo1a9fliQDZYIHY\\\n                  9fEbNm7avEUUJiC6ddv2HTt3mSuBBfhBQEBQSEgYzOIHAHtfTe/vX0uvAAAAJXRFWHRkYXRlOmNy\\\n                  ZWF0ZQAyMDE2LTA5LTEzVDE0OjA2OjEzLTA1OjAwNMgVqAAAACV0RVh0ZGF0ZTptb2RpZnkAMjAx\\\n                  Ni0wOS0xM1QxNDowNjoxMy0wNTowMEWVrRQAAAAASUVORK5CYII=\" />\\\n                  </svg> \\\n                </md-icon>\\\n                <a target=\"_blank\" ng-href=\"{{$ctrl.fullTextLink}}\">\\\n                {{ ::$ctrl.msg }}\\\n                  <prm-icon external-link=\"\" icon-type=\"svg\" svg-icon-set=\"primo-ui\" icon-definition=\"open-in-new\"></prm-icon>\\\n                </a>\\\n              </span>'\n  });\n"]}