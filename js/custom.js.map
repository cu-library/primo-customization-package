{"version":3,"sources":["node_modules/browser-pack/_prelude.js","primo-explore/custom/01OCUL_CRL-CRL_DEFAULT/js/main.js","primo-explore/custom/01OCUL_CRL-CRL_DEFAULT/node_modules/primo-explore-hathitrust-availability/index.js","primo-explore/custom/01OCUL_CRL-CRL_DEFAULT/node_modules/primo-explore-hathitrust-availability/js/hathi-trust-availability.module.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","y","app","angular","service","$http","this","myAccountPersonalSettings","method","url","headers","Authorization","sessionStorage","primoExploreJwt","component","template","bindings","parentCtrl","controller","encodingVal","vm","online","title","hide","hasOwnProperty","item","delivery","Array","isArray","holding","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","itemHolding","value","libraryCode","subLocationCode","_almaRSServiceAvailable","err","return","primawsRest","$onInit","then","response","data","email","user_email","params","URLSearchParams","document","location","search","doc_id","item_id","indexOf","doc_id_array","match","split","isNaN","context","resource_link","encodeURIComponent","window","hostname","has","get","resource_title","pnx","display","resource_author","addata","addau","au","resource_isbn","isbn","issn","resource_mms","mms","resource_date","risdate","date","resource_volume","volume","name","username_tag","querySelector","innerText","resource_type","type","showAccessibleLink","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","buildLink","trim","showAccessibleCopyFormOnClick","$event","open","showAccessibleCopyFormOnEnter","key","heading_text","heading_element","createElement","id","textContent","getElementById","getElementsByTagName","insertAdjacentElement","error","console","log","chatContainer","classList","add","body","appendChild","x","async","src","protocol","parentNode","insertBefore","constant","config","$sceDelegateProvider","hathiTrustBaseUrl","urlWhitelist","resourceUrlWhitelist","push","factory","$q","lookup","ids","hathiTrustLookupUrl","join","jsonp","cache","jsonpCallbackParam","resp","resolve","svc","findRecord","bibData","recordId","Object","keys","records","recordURL","catch","findFullViewRecord","fullTextUrl","result","j","items","rightsCode","fromRecord","hathiTrust","isOclcNum","self","isJournal","msg","hideOnline","isOnline","hideIfJournal","ignoreCopyright","isAvailable","updateHathiTrustAvailability","prmSearchResultAvailabilityLine","format","toLowerCase","availability","GetIt1","some","g","links","l","isLinktoOnline","deliveryCategory","hathiTrustIds","oclcid","filter","map","replace","res","fullTextLink","link","entityId"],"mappings":"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","file":"custom.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","import 'primo-explore-hathitrust-availability';\n(function () {\n    'use strict';\n    var app = angular.module('viewCustom', ['angularLoad', 'hathiTrustAvailability']);\n\n    app.service(\"primawsRest\",['$http', function ($http) {\n        this.myAccountPersonalSettings = function () {\n            return $http({\n                method: 'GET',\n                url: '/primaws/rest/priv/myaccount/personal_settings',\n                headers: {\n                    'Authorization': 'Bearer \"' + sessionStorage.primoExploreJwt + '\"',\n                }\n            });\n        }\n    }]);\n\n    // Include HathiTrust full text links.\n    app.component('prmSearchResultAvailabilityLineAfter', {\n        template: `<hathi-trust-availability msg=\"Full Text Available Online at HathiTrust\" entity-id=\"http://cufed.carleton.ca/adfs/services/trust\">\n                   </hathi-trust-availability>`\n    });\n\n    // Add components to the prmExportRisAfter template.\n    app.component('prmExportRisAfter', {\n        bindings: { parentCtrl: '<' },\n        template: `<carleton-change-ris-encoding parent-ctrl=\"$ctrl.parentCtrl\">\n                   </carleton-acceptable-use-policy-link>`\n    });\n    // Change the default RIS export character encoding to UTF-8.\n    app.component('carletonChangeRisEncoding', {\n        bindings: { parentCtrl: '<' },\n        controller: function() { this.parentCtrl.encodingVal = 'UTF-8'; },\n        template: ''\n    });\n\n    // Add components to the prmServiceHeaderAfter template.\n    app.component('prmServiceHeaderAfter', {\n        bindings: { parentCtrl: '<' },\n        template: `<carleton-acceptable-use-policy-link parent-ctrl=\"$ctrl.parentCtrl\">\n                   </carleton-acceptable-use-policy-link>`\n    });\n    // Add Carleton's Acceptable Use Policy link.\n    app.component('carletonAcceptableUsePolicyLink', {\n        bindings: { parentCtrl: '<' },\n        controller: 'carletonAcceptableUsePolicyLinkController',\n        template: `<a ng-if=\"$ctrl.online()\" target=\"_blank\"\n                       href=\"https://library.carleton.ca/about/policies/electronic-resources-acceptable-use-policy\">\n                       Electronic Resources Acceptable Use Policy\n                       <prm-icon icon-type=\"svg\" svg-icon-set=\"primo-ui\" external-link=\"\" icon-definition=\"open-in-new\"></prm-icon>\n                   </a>`\n    });\n    app.controller('carletonAcceptableUsePolicyLinkController', [function (){\n        var vm = this;\n        vm.online = online;\n        function online(){\n            return vm.parentCtrl.title === 'nui.getit.service_viewit';\n        }\n    }]);\n\n    // Add components to the prmServiceNgrsAfter template.\n    app.component('prmServiceNgrsAfter', {\n        bindings: { parentCtrl: '<' },\n        template: `<carleton-hide-rapido-for-reserves-items parent-ctrl=\"$ctrl.parentCtrl\">\n                   </carleton-hide-rapido-for-reserves-items>`\n    });\n    // Hide Rapido block for reserves items.\n    app.component('carletonHideRapidoForReservesItems', {\n        bindings: { parentCtrl: '<' },\n        controller: 'carletonHideRapidoForReservesItemsController',\n        template: `<span ng-if=\"$ctrl.hide()\"></span>`\n    });\n    app.controller('carletonHideRapidoForReservesItemsController', [function(){\n        var vm = this;\n        vm.hide = hide;\n        function hide(){\n            if (vm.parentCtrl.hasOwnProperty('item') &&\n                vm.parentCtrl.item.hasOwnProperty('delivery') &&\n                vm.parentCtrl.item.delivery.hasOwnProperty('holding') &&\n                Array.isArray(vm.parentCtrl.item.delivery.holding)) {\n                for (const itemHolding of vm.parentCtrl.item.delivery.holding) {\n                    if (itemHolding.libraryCode === \"MACODRUM\" &&\n                        itemHolding.subLocationCode === \"rsv\") {\n                        vm.parentCtrl._almaRSServiceAvailable = \"false\";\n                        break;\n                    }\n                }\n            }\n            return false;\n        }\n    }]);\n\n    // Add components to the prmBriefResultAfter template.\n    app.component('prmBriefResultAfter', {\n        bindings: { parentCtrl: '<' },\n        template: `<carleton-add-alternative-request-form-link parent-ctrl=\"$ctrl.parentCtrl\">\n                   </carleton-add-alternative-request-form-link>`,\n    });\n    // Add the alternative request form link. This was borrowed from McMaster.\n    app.component('carletonAddAlternativeRequestFormLink', {\n        bindings: { parentCtrl: '<' },\n        controller: 'carletonAddAlternativeRequestFormLinkController',\n        template: `<div ng-if=\"$ctrl.showAccessibleLink()\" class=\"alternative-request-form-link\">\n                       <a tabindex=\"0\" ng-click=\"$ctrl.showAccessibleCopyFormOnClick($event)\"\n                                       ng-keypress=\"$ctrl.showAccessibleCopyFormOnEnter($event)\"\n                                       class=\"arrow-link md-primoExplore-theme\">\n                            Get an Accessible Alternate Format\n                            <span class=\"sr-only\">Opens in a new window</span>\n                            <prm-icon external-link=\"\" icon-type=\"svg\" svg-icon-set=\"primo-ui\" icon-definition=\"open-in-new\"></prm-icon>\n                            <prm-icon link-arrow=\"\" icon-type=\"svg\" svg-icon-set=\"primo-ui\" icon-definition=\"chevron-right\"></prm-icon>\n                       </a>\n                   </div>`\n    });\n    app.controller('carletonAddAlternativeRequestFormLinkController', ['primawsRest', function(primawsRest){\n        var vm = this;\n        vm.$onInit = onInit;\n        vm.user_email = \"\";\n        function onInit(){\n\n            // Use the primawsRest service to perform an API call.\n            // This is used to set the user's email value.\n            primawsRest.myAccountPersonalSettings().then(function successCallback(response) {\n                if (response !== null && response !== undefined &&\n                    response.hasOwnProperty('data') &&\n                    response.data.hasOwnProperty('data') &&\n                    response.data.data.hasOwnProperty('email') &&\n                    response.data.data.email.hasOwnProperty('value')) {\n                    vm.user_email = response.data.data.email.value;\n                }\n                }, function errorCallback(response) {\n                    //noop\n            });\n\n            // Create URLSearchParams object to get query string values.\n            var params = new URLSearchParams(document.location.search);\n\n            var doc_id = '';\n            var item_id = vm.parentCtrl.item['@id'];\n            if (item_id !== undefined) {\n                if (item_id.indexOf('https') != -1) {\n                    var doc_id_array = vm.parentCtrl.item['@id'].match(/pnxs.+/)[0].split('/');\n                    doc_id = doc_id_array[2];\n                    if (doc_id_array[3] !== undefined) {\n                        doc_id += '/';\n                        doc_id += doc_id_array[3];\n                    }\n                }\n            }\n            // Primo VE bug fix - We need to prepend \"alma\" to the doc_id if it's purely numeric\n            if (!isNaN(doc_id)) {\n                doc_id = 'alma' + doc_id;\n            }\n            // ... or from the URL\n            if (doc_id === null || doc_id === undefined) {\n                doc_id = '';\n            }\n            var context = vm.parentCtrl.item.context;\n\n            var resource_link = encodeURIComponent('https://' + window.location.hostname + '/discovery/fulldisplay?docid=' + doc_id\n                                                   + '&context=' + context\n                                                   + '&vid=' + (params.has('vid') ? params.get('vid') : '')\n                                                   + '&search_scope=' + (params.has('search_scope') ? params.get('search_scope') : '')\n                                                   + '&tab=' + (params.has('tab') ? params.get('tab') : ''));\n\n            var resource_title = vm.parentCtrl.item.pnx.display.title[0];\n\n            var resource_author = '';\n            if (vm.parentCtrl.item.pnx.addata.addau !== undefined) {\n                resource_author = vm.parentCtrl.item.pnx.addata.addau[0];\n            } else if (vm.parentCtrl.item.pnx.addata.au !== undefined) {\n                resource_author = this.parentCtrl.item.pnx.addata.au[0];\n            }\n\n            var resource_isbn = '';\n            if (vm.parentCtrl.item.pnx.addata.isbn !== undefined) {\n                resource_isbn = vm.parentCtrl.item.pnx.addata.isbn[0];\n            } else if (vm.parentCtrl.item.pnx.addata.issn !== undefined) {\n                resource_isbn = vm.parentCtrl.item.pnx.addata.issn[0];\n            }\n\n            var resource_mms = '';\n            if (vm.parentCtrl.item.pnx.display.mms !== undefined) {\n                resource_mms = vm.parentCtrl.item.pnx.display.mms[0];\n            }\n\n            var resource_date = '';\n            if (vm.parentCtrl.item.pnx.addata.risdate !== undefined) {\n                resource_date = vm.parentCtrl.item.pnx.addata.risdate[0];\n            } else if (vm.parentCtrl.item.pnx.addata.date !== undefined) {\n                resource_date = vm.parentCtrl.item.pnx.addata.date[0];\n            }\n\n            var resource_volume = '';\n            if (vm.parentCtrl.item.pnx.addata.volume !== undefined) {\n                resource_volume = vm.parentCtrl.item.pnx.addata.volume[0];\n            }\n\n            var name = '';\n            const username_tag = document.querySelector(\"prm-user-area-expandable .user-name\");\n            if (username_tag !== null) {\n                name = username_tag.innerText;\n            }\n\n            var resource_type = '';\n            if (vm.parentCtrl.item.pnx.display.type !== undefined) {\n                resource_type = vm.parentCtrl.item.pnx.display.type[0];\n            }\n\n            // only show the Request Acccessible Copy if record type is book or article\n            vm.showAccessibleLink = function(){\n                if (resource_type == 'book' &&\n                    vm.parentCtrl.hasOwnProperty('item') &&\n                    vm.parentCtrl.item.hasOwnProperty('delivery') &&\n                    vm.parentCtrl.item.delivery.hasOwnProperty('holding') &&\n                    Array.isArray(vm.parentCtrl.item.delivery.holding)) {\n                    for (const itemHolding of vm.parentCtrl.item.delivery.holding) {\n                        if (itemHolding.libraryCode === \"MACODRUM\"){\n                            return true;\n                            break;\n                        }\n                    }\n                }\n                return false;\n            }\n            vm.buildLink = function(){\n                return 'https://library.carleton.ca/forms/alternate-format-request-form-page?title='+resource_title\n                        +'&author='+resource_author.trim()\n                        +'&link='+resource_link.trim()\n                        +'&isbn='+resource_isbn.trim()\n                        +'&date='+resource_date\n                        +'&volume='+resource_volume\n                        +'&mms='+resource_mms\n                        +'&name='+name\n                        +'&email='+vm.user_email;\n            }\n            vm.showAccessibleCopyFormOnClick = function($event){\n                window.open(vm.buildLink(), '_blank');\n            }\n            vm.showAccessibleCopyFormOnEnter = function($event){\n                if ($event.key == \"Enter\") {\n                    window.open(vm.buildLink(), '_blank');\n                }\n            }\n        }\n    }]);\n\n    // Add components to the prmActionContainerAfter container.\n    app.component('prmActionContainerAfter', {\n        bindings: { parentCtrl: '<' },\n        template: `<carleton-add-skip-to-header parent-ctrl=\"$ctrl.parentCtrl\">\n                   </carleton-add-skip-to-header>`\n    });\n    // Add a Skip To header. This is borrowed and adapted from UWindsor.\n    app.component('carletonAddSkipToHeader', {\n        bindings: {parentCtrl: '<'},\n        controller: 'carletonAddSkipToHeaderController'\n    });\n    app.controller('carletonAddSkipToHeaderController', [function(){\n        var vm = this;\n        vm.$onInit = onInit;\n        function onInit(){\n            var heading_text = 'Skip To';\n            // Create URLSearchParams object to get query string values.\n            var params = new URLSearchParams(document.location.search);\n            if (params.has('lang', 'fr')) {\n                heading_text = \"Passer à\";\n            }\n            var heading_element = document.createElement('h3');\n            heading_element.id = 'skip-to-header';\n            heading_element.textContent = heading_text;\n            try {\n                document.getElementById('services-index').getElementsByTagName('button')[0].insertAdjacentElement('beforebegin', heading_element);\n            } catch (error){\n                console.log(error);\n            }\n        }\n    }]);\n})();\n(function() {\n    'use strict';\n    // Add the LibraryH3lp container to the page.\n    var chatContainer = document.createElement('div');\n    chatContainer.id = 'libraryh3lp-container';\n    chatContainer.classList.add('needs-js');\n    document.body.appendChild(chatContainer);\n    // Add the LibraryH3lp script, which adds the chat button.\n    var x = document.createElement(\"script\");\n    x.type = \"text/javascript\";\n    x.async = true;\n    x.src = (document.location.protocol === \"https:\" ? \"https://\" : \"http://\") + \"ca.libraryh3lp.com/js/libraryh3lp.js?1213\";\n    var y = document.getElementsByTagName(\"script\")[0];\n    y.parentNode.insertBefore(x, y);\n})();\n","require('./js/hathi-trust-availability.module.js');\nmodule.exports = 'hathiTrustAvailability';\n","angular\n  .module('hathiTrustAvailability', [])\n  .constant(\n    'hathiTrustBaseUrl',\n    'https://catalog.hathitrust.org/api/volumes/brief/json/'\n  )\n  .config([\n    '$sceDelegateProvider',\n    'hathiTrustBaseUrl',\n    function ($sceDelegateProvider, hathiTrustBaseUrl) {\n      var urlWhitelist = $sceDelegateProvider.resourceUrlWhitelist();\n      urlWhitelist.push(hathiTrustBaseUrl + '**');\n      $sceDelegateProvider.resourceUrlWhitelist(urlWhitelist);\n    },\n  ])\n  .factory('hathiTrust', [\n    '$http',\n    '$q',\n    'hathiTrustBaseUrl',\n    function ($http, $q, hathiTrustBaseUrl) {\n      var svc = {};\n\n      var lookup = function (ids) {\n        if (ids.length) {\n          var hathiTrustLookupUrl = hathiTrustBaseUrl + ids.join('|');\n          return $http\n            .jsonp(hathiTrustLookupUrl, {\n              cache: true,\n              jsonpCallbackParam: 'callback',\n            })\n            .then(function (resp) {\n              return resp.data;\n            });\n        } else {\n          return $q.resolve(null);\n        }\n      };\n\n      // find a HT record URL for a given list of identifiers (regardless of copyright status)\n      svc.findRecord = function (ids) {\n        return lookup(ids)\n          .then(function (bibData) {\n            for (var i = 0; i < ids.length; i++) {\n              var recordId = Object.keys(bibData[ids[i]].records)[0];\n              if (recordId) {\n                return $q.resolve(bibData[ids[i]].records[recordId].recordURL);\n              }\n            }\n            return $q.resolve(null);\n          })\n          .catch(function (e) {\n            console.error(e);\n          });\n      };\n\n      // find a public-domain HT record URL for a given list of identifiers\n      svc.findFullViewRecord = function (ids) {\n        var handleResponse = function (bibData) {\n          var fullTextUrl = null;\n          for (var i = 0; !fullTextUrl && i < ids.length; i++) {\n            var result = bibData[ids[i]];\n            for (var j = 0; j < result.items.length; j++) {\n              var item = result.items[j];\n              if (item.rightsCode === 'pd') {\n                fullTextUrl = result.records[item.fromRecord].recordURL;\n                break;\n              }\n            }\n          }\n          return $q.resolve(fullTextUrl);\n        };\n        return lookup(ids)\n          .then(handleResponse)\n          .catch(function (e) {\n            console.error(e);\n          });\n      };\n\n      return svc;\n    },\n  ])\n  .controller('hathiTrustAvailabilityController', [\n    'hathiTrust',\n    function (hathiTrust) {\n      var self = this;\n\n      self.$onInit = function () {\n        if (!self.msg) self.msg = 'Full Text Available at HathiTrust';\n\n        // prevent appearance/request iff 'hide-online'\n        if (self.hideOnline && isOnline()) {\n          return;\n        }\n\n        // prevent appearance/request iff 'hide-if-journal'\n        if (self.hideIfJournal && isJournal()) {\n          return;\n        }\n\n    \t// prevent appearance/request if item is unavailable\n    \tif (self.ignoreCopyright && !isAvailable()) {\n    \t   //allow links for locally unavailable items that are in the public domain\n           self.ignoreCopyright=false;\n        }\n\n        // look for full text at HathiTrust\n        updateHathiTrustAvailability();\n      };\n\n      var isJournal = function () {\n        var format =\n          self.prmSearchResultAvailabilityLine.result.pnx.addata.format[0];\n        return !(format.toLowerCase().indexOf('journal') == -1); // format.includes(\"Journal\")\n      };\n\n      var isAvailable = function isAvailable() {\n\tvar available = self.prmSearchResultAvailabilityLine.result.delivery.availability[0];\n\treturn (available.toLowerCase().indexOf('unavailable') == -1); \n      };\n\n      var isOnline = function () {\n        var delivery =\n          self.prmSearchResultAvailabilityLine.result.delivery || [];\n        if (!delivery.GetIt1)\n          return delivery.deliveryCategory.indexOf('Alma-E') !== -1;\n        return self.prmSearchResultAvailabilityLine.result.delivery.GetIt1.some(\n          function (g) {\n            return g.links.some(function (l) {\n              return l.isLinktoOnline;\n            });\n          }\n        );\n      };\n\n      var formatLink = function (link) {\n        return self.entityId ? link + '?signon=swle:' + self.entityId : link;\n      };\n\n      var isOclcNum = function(value) {\n        return value.match(/^\\(ocolc\\).+/i);\n      }\n\n      var updateHathiTrustAvailability = function () {\n        var hathiTrustIds = (\n          self.prmSearchResultAvailabilityLine.result.pnx.addata.oclcid || []\n        )\n          .filter(isOclcNum)\n          .map(function (id) {\n            return 'oclc:' + id.toLowerCase().replace('(ocolc)', '');\n          });\n        hathiTrust[self.ignoreCopyright ? 'findRecord' : 'findFullViewRecord'](\n          hathiTrustIds\n        ).then(function (res) {\n          if (res) self.fullTextLink = formatLink(res);\n        });\n      };\n    },\n  ])\n  .component('hathiTrustAvailability', {\n    require: {\n      prmSearchResultAvailabilityLine: '^prmSearchResultAvailabilityLine',\n    },\n    bindings: {\n      entityId: '@',\n      ignoreCopyright: '<',\n      hideIfJournal: '<',\n      hideOnline: '<',\n      msg: '@?',\n    },\n    controller: 'hathiTrustAvailabilityController',\n    template:\n      '<span ng-if=\"$ctrl.fullTextLink\" class=\"umnHathiTrustLink\">\\\n                <md-icon alt=\"HathiTrust Logo\">\\\n                  <svg version=\"1.1\" id=\"Layer_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" width=\"100%\" height=\"100%\" viewBox=\"0 0 16 16\" enable-background=\"new 0 0 16 16\" xml:space=\"preserve\">  <image id=\"image0\" width=\"16\" height=\"16\" x=\"0\" y=\"0\"\\\n                  xlink:href=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAACBjSFJN\\\n                  AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAACNFBMVEXuegXvegTsewTveArw\\\n                  eQjuegftegfweQXsegXweQbtegnsegvxeQbvegbuegbvegbveQbtegfuegbvegXveQbvegbsfAzt\\\n                  plfnsmfpq1/wplPuegXvqFrrq1znr2Ptok/sewvueQfuegbtegbrgRfxyJPlsXDmlTznnk/rn03q\\\n                  pVnomkjnlkDnsGnvwobsfhPveQXteQrutHDqpF3qnUnpjS/prmDweQXsewjvrWHsjy7pnkvqqGDv\\\n                  t3PregvqhB3uuXjusmzpp13qlz3pfxTskC3uegjsjyvogBfpmkHpqF/us2rttXLrgRjrgBjttXDo\\\n                  gx/vtGznjzPtfhHqjCfuewfrjCnwfxLpjC7wtnDogBvssmjpfhLtegjtnEjrtnTmjC/utGrsew7s\\\n                  o0zpghnohB/roUrrfRHtsmnlkTbrvH3tnEXtegXvegTveQfqhyHvuXjrrGTpewrsrmXqfRHogRjt\\\n                  q2Dqewvqql/wu3vqhyDueQnwegXuegfweQPtegntnUvnt3fvxI7tfhTrfA/vzJvmtXLunEbtegrw\\\n                  egTregzskjbsxI/ouoPsqFzniyrz2K3vyZnokDLpewvtnkv30J/w17XsvYXjgBbohR7nplnso1L0\\\n                  1Kf40Z/um0LvegXngBnsy5juyJXvsGftrGTnhB/opVHoew7qhB7rzJnnmErkkz3splbqlT3smT3t\\\n                  tXPqqV7pjzHvunjrfQ7vewPsfA7uoU3uqlruoEzsfQ/vegf///9WgM4fAAAAFHRSTlOLi4uLi4uL\\\n                  i4uLi4uLi4tRUVFRUYI6/KEAAAABYktHRLvUtndMAAAAB3RJTUUH4AkNDgYNB5/9vwAAAQpJREFU\\\n                  GNNjYGBkYmZhZWNn5ODk4ubh5WMQERUTl5CUEpWWkZWTV1BUYlBWUVVT19BUUtbS1tHV0zdgMDQy\\\n                  NjE1MzRXsrC0sraxtWOwd3B0cnZxlXZz9/D08vbxZfDzDwgMCg4JdQsLj4iMio5hiI2LT0hMSk5J\\\n                  TUvPyMzKzmHIzcsvKCwqLiktK6+orKquYZCuratvaGxqbmlta+8QNRBl6JQ26Oru6e3rnzBx0uQ8\\\n                  aVGGvJopU6dNn1E8c9bsOXPniYoySM+PXbBw0eIlS5fl1C+PFRFlEBUVXbFy1eo1a9fliQDZYIHY\\\n                  9fEbNm7avEUUJiC6ddv2HTt3mSuBBfhBQEBQSEgYzOIHAHtfTe/vX0uvAAAAJXRFWHRkYXRlOmNy\\\n                  ZWF0ZQAyMDE2LTA5LTEzVDE0OjA2OjEzLTA1OjAwNMgVqAAAACV0RVh0ZGF0ZTptb2RpZnkAMjAx\\\n                  Ni0wOS0xM1QxNDowNjoxMy0wNTowMEWVrRQAAAAASUVORK5CYII=\" />\\\n                  </svg> \\\n                </md-icon>\\\n                <a target=\"_blank\" ng-href=\"{{$ctrl.fullTextLink}}\">\\\n                {{ ::$ctrl.msg }}\\\n                  <prm-icon external-link=\"\" icon-type=\"svg\" svg-icon-set=\"primo-ui\" icon-definition=\"open-in-new\"></prm-icon>\\\n                </a>\\\n              </span>',\n  });\n"]}